<html>
<head>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js"></script>
</head>
<body>
<a href="http://www.google.com">a link</a><br/>
<a href="demo.html">a relative link</a><br/>
<img src="performance.png"/><br/>
<img src="http://www.google.com/intl/en_ALL/images/logo.gif"/>
<div id="log" style="height: 200px; overflow: auto;"></div>
<script type="text/javascript">
(function() {
    var window = this, undefined;

    document.onmousemove = (function() {
        var lastTarg, hideTimeout, showTimeout,
            info = document.createElement("div");
        info.style.position = "absolute";
        info.style.display = "none";
        info.style.zIndex = "9999";
        info.style.background = "#0F0";
        info.className = "info";
        
        document.body.appendChild(info);
        
        function isInfo(elem) {
            if(!elem) { return false; }
        
            do {
                if(elem === info) { return true; }
                elem = elem.parentNode
            } while(elem && elem !== document.body);
            
            return false;
        }
        
        function showInfo(targ) {        
            var $targ = $(targ); // TODO: removed jquery dependency
            var pos = $targ.position(), height = $targ.height();
            var url = targ.src || targ.href;
            
            if(hideTimeout) { clearTimeout(hideTimeout); hideTimeout = null; }
            
            info.style.left = pos.left + "px";
            info.style.top = pos.top + height + "px";
            
            info.innerHTML = "<b>here is some info about </b><br/>" + url;
        }
        
        return function onmousemove(e) {
            e = e || window.event;
            var targ = e.target || e.srcElement;
            if(targ.nodeType === 3) { targ = targ.parentNode; }
            
            if(isInfo(targ)) {
                if(hideTimeout) { hideTimeout = clearTimeout(hideTimeout); }
                info.style.display = "block";
                return; 
            }
            
            if(lastTarg === targ) { return; }
            
            showTimeout = clearTimeout(showTimeout);
            lastTarg = targ;
            
            if(targ.src || targ.href) {
                showTimeout = (function(targ) { 
                    return setTimeout(function() { showInfo(targ); showTimeout = null; }, 1000); 
                })(targ);
            } else if(info.style.display === "block") {
                hideTimeout = setTimeout(function() { info.style.display = "none"; hideTimeout = null; }, 500);
            }
        }
    })();
})();
</script>
</body>
</html>
